---
---

<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <title>Reproducible Workflows in RStudio</title>
    <meta name="description" content="Learn tools for collaborative and reproducible research.">
    
    <link rel="canonical" href="/basic-git-lesson/">

    <link rel="stylesheet" href="https://cdn.rawgit.com/SESYNC-ci/lesson-stylesheets/1.0.0/css/lesson.css">

    <style type="text/css">

     table {
	 margin-bottom: 15px;
     }

     table th, table td {
	 padding: 5px 10px;
     }

     table > thead > .header {
	 background: transparent;
     }

     table > thead > tr > td, table > thead > tr > th,
     table > tbody > tr > td, table > tbody > tr > th,
     table > tfoot > tr > td, table > tfoot > tr > th {
	 border: 1px solid #DDD;
     }

     table > thead > tr > th,
     table > thead > tr > td {
	 border-bottom-width: 2px;
     }

     table tbody > tr:nth-of-type(2n+1) {
	 background-color: #F9F9F9;
     }

     p.captioned {
	 text-align: center;
     }

     .captioned em {
	 font-size: 0.6em;
     }

     .ToS {
	 text-align: right;
     }

     .text-document.highlighter-rouge pre {
	 border-radius: 0px 0px 5px 5px;
     }
     
     div.text-document::before {
	 content: attr(title);
	 font-family:Monaco, Bitstream Vera Sans Mono, Lucida Console, Terminal, Consolas, Liberation Mono, DejaVu Sans Mono, Courier New, monospace;
	 font-size: 14px;
	 color: #000000;
	 background: #C0C0C0;
	 padding:8px 15px;
	 border-radius:5px 5px 0px 0px;
	 border:1px solid #e5e5e5;
	 display: block;
     }     
    </style>
    
</head>

  
  <body>

    <div class="page-content">
      <div class="wrapper">
        
<p><a name="/slides/title"></a></p>

<h1 id="reproducible-workflows-in-rstudio">Reproducible Workflows in RStudio</h1>

<p>Instructor: Ian Carroll</p>

<p>As your research project moves from conception, through data collection and analysis, to reporting and other forms of dissemination, the many components can fracture, lose their development history, and – worst of all – become conflicted.</p>

<p>This lesson gives a high level overview of workflows to organize your project and introduces an accompanying software solution, <code class="highlighter-rouge">git</code>.</p>

<p class="ToS"><a href="#/slides/title">Top of Section</a></p>

<hr />

<p><a name="/slides/workflows"></a></p>

<h2 id="vizualizing-a-workflow">Vizualizing a Workflow</h2>

<p class="captioned"><img src="/basic-git-lesson/images/rp-overview.jpg" alt="" width="60%" /><br />
<em>Credit: <a href="http://cacm.acm.org/blogs/blog-cacm/169199-data-science-workflow-overview-and-challenges">Philip Guo</a></em></p>

<!--split-->

<h2 id="real-research-workflows">Real Research Workflows</h2>

<p>A professor at UC Berkeley, Carl Boettiger, is a strong advocate for open science.
We can navigate to the results of his careful workflows at <a href="http://www.carlboettiger.info">www.carlboettiger.info</a>.</p>

<p>The work leading up to his <a href="http://github.com/cboettig/pdg_control">“Pretty Darn Good Control”</a> publication is on GitHub, a website integrated with the <code class="highlighter-rouge">git</code> version control system that work together as a system for project management, collaboration and sharing.</p>

<p class="ToS"><a href="#/slides/workflows">Top of Section</a></p>

<hr />

<p><a name="/slides/intro"></a></p>

<h2 id="distributed-workflows">Distributed Workflows</h2>

<p class="on-white">A single collaboration model – the centralized workflow – dominates collaborative research.
There is a central hub, and everyone synchronizes their work to it.
A number of researchers are nodes – consumers of that hub – and synchronize to that one place.</p>

<p class="ToS"><a href="#/slides/intro">Top of Section</a></p>

<hr />

<p><a name="/slides/goals"></a></p>

<h2 id="objectives-for-this-lesson">Objectives for this lesson</h2>

<ul>
  <li>Learn about a framework for distributed workflows</li>
  <li>Identify attributes of reproducible research</li>
  <li>Use RStudio to begin managing a workflow</li>
</ul>

<!--split-->

<h2 id="specific-achievements">Specific achievements</h2>

<ul>
  <li>Access a public repository through RStudio</li>
  <li>Create a repository on GitHub</li>
  <li>Publish changes to a project file</li>
  <li>Execute a few basic R commands</li>
</ul>

<p class="ToS"><a href="#/slides/goals">Top of Section</a></p>

<hr />

<p><a name="/slides/reproducible"></a></p>

<h2 id="a-plug-for-reproducible-research">A Plug for Reproducible Research</h2>

<p>Reproducibility is a core tenent of the scientific method.
Experiments are reported in sufficient detail for a skilled practitioner to duplicate the result.</p>

<p class="fragment">Does the same principle apply to data analysis? <strong>You bet!</strong></p>

<!--split-->

<h3 id="hallmarks-of-reproducible-research">Hallmarks of reproducible research:</h3>

<table>
  <tbody>
    <tr>
      <td><strong>Reviewable</strong></td>
      <td>All details of the method used are easily accessible for peer review and community review.</td>
    </tr>
    <tr>
      <td><strong>Auditable</strong></td>
      <td>Records exist to document how the methods and conclusions evolved, but may be private.</td>
    </tr>
    <tr>
      <td><strong>Replicable</strong></td>
      <td>Given sufficient resources, a skilled practitioner could duplicate the research without any guesswork.</td>
    </tr>
    <tr>
      <td><strong>Open</strong></td>
      <td>The orginator grants permissions for reuse and extension of the research products.</td>
    </tr>
  </tbody>
</table>

<!--split-->

<h3 id="use-your-workflow-to-achieve-these-same-goals">Use your workflow to achieve these same goals:</h3>

<table>
  <tbody>
    <tr>
      <td><strong>Reviewable</strong></td>
      <td>Write-ups and thoroughly-commented scripts shared among collaborators</td>
    </tr>
    <tr>
      <td><strong>Auditable</strong></td>
      <td>Versioned project history, used to revert mistakes when necessary</td>
    </tr>
    <tr>
      <td><strong>Replicable</strong></td>
      <td>“One-click” file &amp; data sharing, as well as streamlined recreation of analyses</td>
    </tr>
    <tr>
      <td><strong>Open</strong></td>
      <td>GitHub (or similar) based centralized workflow</td>
    </tr>
  </tbody>
</table>

<p class="ToS"><a href="#/slides/reproducible">Top of Section</a></p>

<hr />

<p><a name="/slides/github"></a></p>

<h3 id="whats-a-github-whats-a-repo">What’s a GitHub? What’s a “repo”?</h3>

<p>Open up the <a href="https://github.com/SESYNC-ci/handouts" target="">repository</a> that provides the “handouts” for this workshop.</p>

<ul>
  <li>README.md is a Markdown file giving basic information about the repository.</li>
  <li>There is a list of files, including a folder for data.</li>
  <li>You are looking at a branch called <code class="highlighter-rouge">master</code>.</li>
  <li>The commit history is available from the top bar.</li>
  <li>The “Clone or download” button provides a URL.</li>
</ul>

<!--split-->

<h3 id="centralized-workflow">Centralized Workflow</h3>

<p class="captioned"><img src="/basic-git-lesson/images/atlassian_workflow.svg" alt="" width="50%" /><br />
<em><a href="https://www.atlassian.com/git/tutorials/comparing-workflows">Image</a> by Atlassian / <a href="http://creativecommons.org/licenses/by/2.5/au/">CC BY</a></em></p>

<p>The <strong>origin</strong> is the central repository, in this case it lives on GitHub. Every member of the team gets a <strong>local</strong> copy of the entire project, called a <strong>clone</strong>.</p>

<!--split-->

<h3 id="clone-the-handouts-repo-in-rstudio">Clone the <code class="highlighter-rouge">handouts</code> repo in RStudio</h3>

<ul>
  <li>Create a new project from version control.</li>
  <li>Enter the handouts repository URL.</li>
  <li>Choose a location where you want a new folder (containing the cloned repository) created.</li>
</ul>

<!--split-->

<p class="captioned"><img src="/basic-git-lesson/images/atlassian_pull.svg" alt="" width="50%" /><br />
<em><a href="https://www.atlassian.com/git/tutorials/comparing-workflows">Image</a> by Atlassian / <a href="http://creativecommons.org/licenses/by/2.5/au/">CC BY</a></em></p>

<p>Cloning is the initial <strong>pull</strong> of the entire project and all its history. In general, a worker <strong>pulls</strong> the work of other teammates from the <strong>origin</strong> when ready to incorporate their work, and she <strong>pushes</strong> updates to the <strong>origin</strong> when ready to contribute work of her own work.</p>

<!--split-->

<p>A commit is a unit of work: any collection of changes to one or more files in the repository.
A versioned project is like a tree of commits, although the current tree has just one <strong>branch</strong>.
After a worker creates a <strong>clone</strong>, the local copy is in the same place as the <strong>origin</strong>.</p>

<p class="captioned"><img src="/basic-git-lesson/images/atlassian_clone.svg" alt="" width="40%" /><br />
<em><a href="https://www.atlassian.com/git/tutorials/syncing/git-pull">Image</a> by Atlassian / <a href="http://creativecommons.org/licenses/by/2.5/au/">CC BY</a></em></p>

<!--split-->

<p>A <strong>pull</strong>, or initially a <strong>clone</strong>, applies commits copied from the <strong>origin</strong> to your local repo, syncing them up.</p>

<p class="captioned"><img src="/basic-git-lesson/images/atlassian_after_pull.svg" alt="" width="40%" /><br />
<em><a href="https://www.atlassian.com/git/tutorials/syncing/git-pull">Image</a> by Atlassian / <a href="http://creativecommons.org/licenses/by/2.5/au/">CC BY</a></em></p>

<!--split-->

<p>A <strong>push</strong> copies local commits to the <strong>origin</strong> and applies them remotely.</p>

<p class="captioned"><img src="/basic-git-lesson/images/atlassian_after_push.svg" alt="" width="40%" /><br />
<em><a href="https://www.atlassian.com/git/tutorials/syncing/git-pull">Image</a> by Atlassian / <a href="http://creativecommons.org/licenses/by/2.5/au/">CC BY</a></em></p>

<p class="ToS"><a href="#/slides/github">Top of Section</a></p>

<hr />

<p><a name="/slides/rstudio"></a></p>

<h2 id="rstudio-projects">RStudio Projects</h2>

<p>This software is an example of an <em>integrated development environment</em> and focuses on</p>

<ol>
  <li>Creating projects that use the R programming language, and</li>
  <li>Running R language commands or  programs in the R interpreter.</li>
</ol>

<p>R is both a <strong>language</strong> and an <strong>interpreter</strong>.</p>

<!--split-->

<h2 id="the-console">The Console</h2>

<p>The interpreter accepts R commands interactively through the console. Basic math are valid commands in the R language:</p>

<div class="input highlighter-rouge"><pre class="highlight"><code>1 + 2
</code></pre>
</div>

<div class="output highlighter-rouge"><pre class="highlight"><code>[1] 3
</code></pre>
</div>

<div class="input highlighter-rouge"><pre class="highlight"><code>4^2/sqrt(4)
</code></pre>
</div>

<div class="output highlighter-rouge"><pre class="highlight"><code>[1] 8
</code></pre>
</div>

<!--split-->

<dl>
  <dt>Question</dt>
  <dd>Why is the output prefixed by <code class="highlighter-rouge">[1]</code>?</dd>
  <dt>Answer</dt>
  <dd class="fragment">That’s the index, or position in a vector, of the first result.</dd>
</dl>

<!--split-->

<p>A command giving a vector of results shows this clearly</p>

<div class="input highlighter-rouge"><pre class="highlight"><code>seq(1, 100)
</code></pre>
</div>

<div class="output highlighter-rouge"><pre class="highlight"><code>[1]   1   2   3   4   5   6   7   8   9  10  11  12  13  14  15  16  17  18  19  20  21  22  23  24  25  26  27
[28]  28  29  30  31  32  33  34  35  36  37  38  39  40  41  42  43  44  45  46  47  48  49  50  51  52  53  54
[55]  55  56  57  58  59  60  61  62  63  64  65  66  67  68  69  70  71  72  73  74  75  76  77  78  79  80  81
[82]  82  83  84  85  86  87  88  89  90  91  92  93  94  95  96  97  98  99 100
</code></pre>
</div>

<!--split-->

<h2 id="the-editor">The Editor</h2>

<p>The console is for evaluating commands you don’t intend to keep or reuse. It’s useful for testing commands and poking around. The editor is where you compose scripts that will process data, perform analyses, code up visualizations, and even compose reports.</p>

<p>So we’re not starting from scratch in the editor, let’s use RStudio to clone the handouts repository.</p>

<!--split-->

<p>Open up ‘lesson-1.R’ in the editor, and follow along by replacing the <code class="highlighter-rouge">...</code> placeholders with the code here.</p>

<div class="text-document highlighter-rouge" title="lesson-1.R"><pre class="highlight"><code>vals &lt;- c(5, 6, 12)
</code></pre>
</div>

<!--split-->

<p>The elements of this statement, from right to left are:</p>

<ul>
  <li><code class="highlighter-rouge">)</code> is the closing paren of a function call</li>
  <li><code class="highlighter-rouge">5, 6, 12</code> are three arguments or parameters to the function</li>
  <li><code class="highlighter-rouge">(</code> is the opening paren of a function call</li>
  <li><code class="highlighter-rouge">c</code> is the name of the function</li>
  <li><code class="highlighter-rouge"> &lt;- </code> is an operator that assigns what’s named on the left to equal the result of the expression on the right</li>
  <li><code class="highlighter-rouge">vals</code> is the name of a variable</li>
</ul>

<!--split-->

<dl>
  <dt>Question</dt>
  <dd>Why call <code class="highlighter-rouge">vals</code> a “variable” and <code class="highlighter-rouge">c</code> a “function”?</dd>
  <dt>Answer</dt>
  <dd class="fragment">The distinguishing feature is that a function is callable, which is indicated in documentation by writing the function name with empty parens, as in <code class="highlighter-rouge">c()</code>.</dd>
</dl>

<!--split-->

<p>The variable <code class="highlighter-rouge">vals</code> held a vector, which if we made into the column of a table we’d have our first proper dataset … of sorts. The most common way of holding data in R is within a <code class="highlighter-rouge">data.frame</code>, created by a function of the same name.</p>

<div class="text-document highlighter-rouge" title="lesson-1.R"><pre class="highlight"><code>data &lt;- data.frame(counts = vals)
</code></pre>
</div>

<!--split-->

<p>Print the data simply by entering it’s name on the console:</p>

<div class="input highlighter-rouge"><pre class="highlight"><code>data
</code></pre>
</div>

<div class="output highlighter-rouge"><pre class="highlight"><code>  counts
1      5
2      6
3     12
</code></pre>
</div>

<!--split-->

<p>Or examine its structure with the <code class="highlighter-rouge">str()</code> function:</p>

<div class="input highlighter-rouge"><pre class="highlight"><code>str(data)
</code></pre>
</div>

<div class="output highlighter-rouge"><pre class="highlight"><code>'data.frame':3 obs. of  1 variable:
 $ counts: num  5 6 12	 
</code></pre>
</div>

<!--split-->

<h2 id="anatomy-of-a-function">Anatomy of a function</h2>

<p>The best way to understand the terminology and workings of R is to compose your own function. Like all programming languages, R has keywords that are reserved for import activities, like creating functions. Keywords are usually very intuitive, the one we need is <code class="highlighter-rouge">function</code>.</p>

<div class="text-document highlighter-rouge" title="lesson-1.R"><pre class="highlight"><code>function(...) {
    ...
	return(...)
}
</code></pre>
</div>

<!--split-->

<p>We’ll make a function to extract the first row and column of its argument, for which we can choose an arbitrary name:</p>

<div class="text-document highlighter-rouge" title="lesson-1.R"><pre class="highlight"><code>function(df) {
    result &lt;- df[[1, 1]]
    return result
}
</code></pre>
</div>

<p>Note that <code class="highlighter-rouge">df</code> doesn’t exist until we call the function, which gives the recipe for how <code class="highlighter-rouge">df</code> will be handled.</p>

<!--split-->

<p>Finally, we need to give the function a name so we can use it like we used <code class="highlighter-rouge">c()</code> and <code class="highlighter-rouge">seq()</code> above.</p>

<div class="text-document highlighter-rouge" title="lesson-1.R"><pre class="highlight"><code>first &lt;- function(df) {
    result &lt;- df[[1, 1]]
    return result
}
</code></pre>
</div>

<div class="input highlighter-rouge"><pre class="highlight"><code>first(data)
</code></pre>
</div>

<div class="output highlighter-rouge"><pre class="highlight"><code>[1] 5
</code></pre>
</div>

<!--split-->

<dl>
  <dt>Question</dt>
  <dd>Can you explain the result of entering <code class="highlighter-rouge">first(vals)</code> into the console?</dd>
  <dt>Answer</dt>
  <dd class="fragment">The function caused an error, which prompted the interpreter to print a helpful error message. Never ignore an error message.</dd>
</dl>

<!--split-->

<h2 id="save-your-work">Save your work</h2>

<p>Do save the ‘lesson-1.R’ file.</p>

<p>But I mean <em>really</em> save your work, by commiting it to your project and syncing up to a GitHub repository.</p>

<ol>
  <li>Go to the <code class="highlighter-rouge">git</code> tab in RStudio</li>
  <li>Select <code class="highlighter-rouge">commit</code> to open the “Review Changes” window</li>
  <li>Select the file(s) you want to commit.</li>
  <li>Enter a descriptive message about the commit.</li>
  <li>Commit!</li>
</ol>

<!--split-->

<h2 id="create-a-github-repository">Create a GitHub repository</h2>

<p>Create a new repository on your GitHub page, name it whatever you like, but leave it empty (no README!).</p>

<p class="captioned"><img src="/basic-git-lesson/images/new_repo.png" alt="" width="60%" /></p>

<p>Once it’s created, find the “Clone or download” URL.</p>

<!--split-->

<h2 id="change-the-url-for-the-origin-repo">Change the url for the origin repo</h2>

<p>The <code class="highlighter-rouge">system</code> function in <code class="highlighter-rouge">lesson-1.R</code> sends the string directly to the operating system, which uses the <code class="highlighter-rouge">git</code> program itself to do something we can’t do through RStudio.</p>

<p>Open the “Review Changes” window again and notice that your branch is ahead of origin/master! Push those commit(s) to your GitHub repo.</p>

<!--split-->

<h2 id="install-missing-packages">Install missing packages</h2>

<p>The last thing we’ll do before taking a break, is let R install any packages you’ll need today. But we’ll learn something new along the way.</p>

<div class="text-document highlighter-rouge" title="lesson-1.R"><pre class="highlight"><code>requirements &lt;- c('tidyr',
                  'ggplot2',
				  'RSQLite',
				  'rmarkdown')
missing &lt;- setdiff(requirements,
                   rownames(installed.packages()))
</code></pre>
</div>

<!--split-->

<p>Check, from the console, your number of missing packages:</p>

<div class="input highlighter-rouge"><pre class="highlight"><code>length(missing) == 0
</code></pre>
</div>

<p>Your result will be <code class="highlighter-rouge">TRUE</code> or <code class="highlighter-rouge">FALSE</code>, depending on whether you installed all the packages already. We can let the script decide what to do with this information.</p>

<!--split-->

<p>The keyword <code class="highlighter-rouge">if</code> is part of the R language’s syntax for flow control. The statement in the body (between <code class="highlighter-rouge"><span class="p">{</span></code> and <code class="highlighter-rouge">}</code>) only evaluates if the argument (between <code class="highlighter-rouge">(</code> and <code class="highlighter-rouge">)</code>) evaluates to TRUE.</p>

<div class="text-document highlighter-rouge" title="lesson-1.R"><pre class="highlight"><code>if (length(missing) != 0) {
  install.packages(missing)
}
</code></pre>
</div>

<p class="ToS"><a href="#/slides/rstudio">Top of Section</a></p>

<hr />

<p><a name="/slides/conclude"></a></p>

<h2 id="summary">Summary</h2>

<p>The repository you created is an example of the heart of a distributed workflow. Putting the <strong>origin</strong> of your project on GitHub (or similar) will make it accessible not only by your collaborators, but also availabe for review and extension by your research community.</p>

<p>Using <code class="highlighter-rouge">git</code> to manage contributions to the project as a branching and merging “tree” of commits accomplishes two objectives. First, work can safely proceed in parallel, even on the same documents. Second, a recoverable (and auditable) trail of changes is immediately available in the project history.</p>

<p>Sharing project files, including managing multiple “copies” during development or at public release, in a hub-and-spokes workflow is a streamlined <strong>cloning</strong> process. The <strong>origin</strong> always has the “most recent” version of any documents: conflicts must be resolved in the local clone before new commits can be shared.</p>

<p class="ToS"><a href="#/slides/conclude">Top of Section</a></p>

<hr />


      </div>
    </div>

  </body>

</html>
